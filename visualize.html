<!DOCTYPE html>
<meta charset='utf-8'>
<title>Median ZvP Supply</title>
<style>
  body {
    margin: 0;
    text-align: center;
  }
  svg {
    font-size: 16px;
  }
  rect {
    stroke: #fff;
    stroke-width: .1px;
  }
  path.domain {
    fill: none;
  }
  line {
    stroke: black;
  }
  .trendline {
    fill: none;
    stroke: black;
  }
  .tick line {
    opacity: .25;
  }
  .tick:nth-child(4n+3) line {
    opacity: .5;
  }
  .tick:nth-child(4n+1) line {
    opacity: 1;
  }
  .tick:nth-child(2n) text {
    display: none;
  }
  .title {
    font-size: 24px;
  }
</style>
<body>
<script src='http://d3js.org/d3.v3.min.js'></script>
<script>
function buildSvg(w, h) {
  return d3
    .select('body')
    .append('svg')
    .attr('width', w)
    .attr('height', h);
}

function buildScale(start, end, max) {
  return d3.scale.linear().domain([0, 200]).range([start, end]);
}

function buildLine(x, y) {
  return d3.svg.line()
    .x(function(d) {
      return x(d.z);
    })
    .y(function(d) {
      return y(d.p);
    });
}

  var dataSet = d3.csv('medianByTime.csv', function(data) {

    var margin = [40, 80, 80, 80];
    var w = 1200 - margin[1] - margin[3];
    var h = 800 - margin[0] - margin[2];
    var tickOverlap = 5;
    var ticks = 40;

    var xScale = buildScale(0, w);
    var yScale = buildScale(h, 0);

    var line = buildLine(xScale, yScale);

    var svg = buildSvg(w + margin[1] + margin[3], h + margin[0] + margin[2]);

    var graph = svg
      .append('svg:g')
        .attr('transform', 'translate(' + margin[3] + ',' + margin[0] + ')');


    graph.append('text')
      .attr('transform', 'translate(' + (w/2) + ',' + (-10) + ')')
      .attr('style', 'text-anchor: middle;')
      .attr('class', 'title')
      .text('Median Zerg vs Protoss Supply Over Time');

    var xAxis = d3.svg.axis().scale(xScale).tickSize(-h-tickOverlap).ticks(ticks).tickSubdivide(true);
    graph.append('svg:g')
      .attr('class', 'x axis')
      .attr('transform', 'translate(0,' + (h + tickOverlap) + ')')
      .call(xAxis);

    graph.append('text')
      .attr('transform', 'translate(' + (w/2) + ',' + (h + tickOverlap + 40) + ')')
      .attr('style', 'text-anchor: middle;')
      .text('Zerg Supply');

    var yAxisLeft = d3.svg.axis().scale(yScale).tickSize(-w-tickOverlap).ticks(ticks).orient('left');
    graph.append('svg:g')
      .attr('class', 'y axis')
      .attr('transform', 'translate(-' + tickOverlap + ',0)')
      .call(yAxisLeft);

    graph.append('text')
      .attr('transform', 'translate(-' + (tickOverlap + 40) + ',' + h/2 + ') rotate(-90)')
      .attr('style', 'text-anchor: middle;')
      .text('Protoss Supply');

    graph.append('svg:path')
    .attr('d', line(data))
    .attr('class', 'trendline');

    var points = graph.selectAll('circle')
      .data(data)
      .enter()
      .append('circle')
      .attr('cx', function(d){return xScale(d.z);})
      .attr('cy', function(d){return yScale(d.p);})
      .attr('r', 2);
  });

</script>
